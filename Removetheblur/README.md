# AI图片清晰化Agent

一个使用GPT API和关键词提示，通过AI将模糊图片变清晰的智能Agent。

## 功能特性

- 🤖 **AI驱动处理**：使用OpenAI Images API直接编辑现有图片
- 🎯 **固定提示词**：使用固定提示词"请把这个图变成全景深，整个画面中模糊虚化的地方变清晰，边缘锐利。"
- 📐 **智能尺寸调整**：支持调整输出尺寸，类似PS智能对象放大
- ✨ **高质量输出**：使用OpenAI Images API编辑图片，保留原图内容并使其变清晰

## 工作原理

1. **加载原图**：读取需要处理的图片
2. **AI编辑**：使用OpenAI Images API (`gpt-image-1.5`模型)，不带mask整图修复，根据固定提示词直接编辑现有图片
3. **输出结果**：保存编辑后的清晰图片，保留原图内容

**技术特点**：
- 使用 `gpt-image-1.5` 模型
- 不带mask，整图修复（最适合背景虚化修正）
- 支持任意输出尺寸（如2160x3240）
- 从base64解码返回的图片数据

## ⚠️ 重要说明：架构说明

**当前系统采用混合架构：**

- ✅ **Web界面**：完全本地运行（Flask服务器）
- ✅ **文件操作**：完全本地运行（图片切分、拼接、保存）
- ❌ **AI处理**：需要调用OpenAI API（外部服务，需要网络）

**这意味着：**
- 需要有效的OpenAI API密钥
- 需要网络连接访问OpenAI服务器
- 会产生API调用费用
- 处理速度受网络影响

**为什么使用外部API？**
- 使用最先进的AI模型，处理质量最好
- 不需要本地GPU资源
- 不需要下载大型模型文件（几GB到几十GB）
- 代码简单，易于维护

如果需要完全本地运行，需要使用本地AI模型（如Stable Diffusion），需要GPU支持和大量存储空间。详见 `架构说明.md`

## 安装

1. 克隆或下载项目

2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 配置环境变量：
   - 复制 `env_example.txt` 为 `.env`
   - 在 `.env` 文件中填入你的 OpenAI API Key：
   ```
   OPENAI_API_KEY=your_api_key_here
   ```

## 使用方法

### 基本用法

```bash
# 基本使用（使用原图尺寸）
python main.py input.jpg

# 指定输出路径
python main.py input.jpg -o output.jpg
```

### 指定输出路径

```bash
python main.py input.jpg -o output.jpg
```

### 调整输出尺寸

```bash
# 调整输出尺寸（支持任意尺寸，如2160x3240）
python main.py input.jpg -s 2160x3240
```

### 完整示例

```bash
# 输出2160x3240尺寸的清晰图片
python main.py photo.jpg -o result.jpg -s 2160x3240
```

## 参数说明

- `input`: 输入图片路径（必需）
- `-o, --output`: 输出图片路径（可选，默认：输入文件名_clear.jpg）
- `-s, --size`: 目标尺寸，格式 WIDTHxHEIGHT（可选，默认使用原图尺寸）

## 固定提示词

系统使用固定提示词："请把这个图变成全景深，整个画面中模糊虚化的地方变清晰，边缘锐利。"

这个提示词会指导AI：
- 将图片变成全景深效果（整个画面都清晰）
- 将模糊虚化的地方变清晰
- 确保边缘锐利

## 配置说明

在 `.env` 文件中可以配置：

- `OPENAI_API_KEY`: OpenAI API密钥（必需）
- `MAX_IMAGE_SIZE`: 用于AI分析的最大图片尺寸，默认2048
- `OUTPUT_QUALITY`: 输出图片质量（1-100），默认95

## 注意事项

1. **API要求**：
   - 需要有效的OpenAI API Key
   - 需要Images API的访问权限
   - API调用会产生费用

2. **图片要求**：
   - 输入图片会被转换为PNG格式用于API调用
   - 图片会被调整为指定尺寸（如果指定了-s参数）
   - 不带mask，整图修复（非常适合背景虚化修正）

3. **尺寸支持**：
   - 支持任意输出尺寸，如2160x3240
   - 如果不指定尺寸，将使用原图尺寸

4. **处理时间**：
   - Images API编辑：约20-60秒

5. **图片格式**：支持常见图片格式（JPG, PNG等），内部会转换为PNG格式

## 技术栈

- Python 3.8+
- OpenAI API (Images API - 图像编辑)
- Pillow (图像处理)
- Requests (HTTP请求)

## 使用建议

1. **尺寸选择**：
   - 如果不指定尺寸，将使用原图尺寸
   - 可以指定任意尺寸，系统会自动调整

2. **处理效果**：
   - API会根据固定提示词编辑整个图片
   - 模糊区域会被处理为清晰
   - 整个画面会变成全景深效果

## 许可证

MIT License

