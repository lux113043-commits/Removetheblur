# 系统架构说明

## 当前架构

```
┌─────────────────┐
│  本地Web界面    │  ← 本地运行 (Flask)
│  (Flask)        │     http://localhost:5000
└────────┬────────┘
         │
         │ 用户上传/选择图片
         ▼
┌─────────────────┐
│  本地处理逻辑   │  ← 本地运行 (Python)
│  (切分/拼接)    │
└────────┬────────┘
         │
         │ 调用API处理图片
         ▼
┌─────────────────┐
│  OpenAI API     │  ← 外部服务 (需要网络)
│  (gpt-image-1)  │     https://api.openai.com
└─────────────────┘
```

## 为什么需要外部服务？

### 1. **图片AI处理需要外部API**
- 图片的背景修复、清晰化处理使用的是 **OpenAI Images API**
- 这个API运行在OpenAI的服务器上，需要网络连接
- API地址：`https://api.openai.com/v1/images/edits`

### 2. **本地运行的部分**
- ✅ Web界面（Flask服务器）- 完全本地
- ✅ 图片切分和拼接 - 完全本地
- ✅ 文件管理 - 完全本地

### 3. **需要外部服务的部分**
- ❌ 图片AI处理 - 需要调用OpenAI API
- ❌ 需要有效的API密钥
- ❌ 需要网络连接
- ❌ 会产生API调用费用

## 工作流程

1. **用户操作**（本地）
   - 在浏览器中选择图片文件夹
   - 点击"开始处理"

2. **本地处理**（本地）
   - 切分图片为1024×1024
   - 准备API调用

3. **API调用**（外部）
   - 发送图片到OpenAI服务器
   - OpenAI服务器处理图片
   - 返回处理后的图片

4. **本地处理**（本地）
   - 接收处理后的图片
   - 无缝拼接成1024×1536
   - 保存到本地文件夹

## 为什么这样设计？

### 优势
- ✅ 使用最先进的AI模型（OpenAI的gpt-image-1）
- ✅ 处理效果好，质量高
- ✅ 不需要本地GPU资源
- ✅ 不需要下载大型模型文件

### 限制
- ❌ 需要网络连接
- ❌ 需要API密钥
- ❌ 会产生费用
- ❌ 处理速度受网络影响

## 如果希望完全本地运行

如果要完全本地运行（不依赖外部API），需要：

1. **使用本地AI模型**
   - 例如：Stable Diffusion、Real-ESRGAN等
   - 需要下载模型文件（通常几GB到几十GB）
   - 需要GPU支持（CPU会很慢）

2. **修改代码**
   - 替换 `gpt_handler.py` 中的API调用
   - 使用本地模型推理
   - 需要安装相应的深度学习框架（PyTorch/TensorFlow）

3. **性能考虑**
   - 本地处理速度取决于硬件
   - GPU处理：较快
   - CPU处理：很慢（可能几分钟一张图）

## 当前方案的选择

当前使用OpenAI API是因为：
- ✅ 处理质量最好
- ✅ 不需要本地GPU
- ✅ 代码简单，易于维护
- ✅ 处理速度快（20-60秒/张）

## 总结

- **Web界面**：完全本地运行 ✅
- **图片处理**：需要调用OpenAI API（外部服务）❌
- **文件操作**：完全本地运行 ✅

这是**混合架构**：界面和文件操作在本地，AI处理在云端。





